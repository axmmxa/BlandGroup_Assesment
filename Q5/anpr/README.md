# ANPR Processing Service

This project implements a Node.js service for processing Automated Number Plate Recognition (ANPR) camera data. The service reads `.lpr` files generated by multiple ANPR cameras, extracts relevant data, and stores it in a SQL database. It ensures that no file is processed more than once and supports querying the stored data based on date range and camera.

## Features

## Features

- Processes `.lpr` files containing vehicle plate reads, which are generated by ANPR cameras and placed in the **ACS Output Test** folder.
- Stores extracted data in a SQL database.
- Ensures each file is processed only once, regardless of the camera.
- Monitors the **ACS Output Test** folder for new files and processes them in real-time.
- Allows queries to retrieve plate reads by date range and camera.

## File Format

The service processes `.lpr` files with the following format:

### Field Descriptions

| Field             | Example       | Description                                              |
|-------------------|---------------|----------------------------------------------------------|
| CountryOfVehicle  | GBZ           | Country of origin                                        |
| RegNumber         | r9112A        | Number plate of the vehicle (leading 'r' can be dropped) |
| ConfidenceLevel   | r77           | Camera confidence level (leading 'r' can be dropped)     |
| CameraName        | rGIBEXIT2     | Camera name (leading 'r' can be dropped)                 |
| Date              | 20140827      | Date of capture (format yyyymmdd)                        |
| Time              | 1210          | Time of capture (format HHmm in 24-hour time)            |
| ImageFilename     | w27082014,12140198,9112A,77.jpg | Name of the image file                 |

## Database Structure

Using phpMyAdmin, you can enter the SQL language directly into the SQL tab, allowing for seamless 
database management and modifications as needed.
The service uses a SQL database to store the processed data. The recommended table structure is as follows:

```sql
CREATE DATABASE anpr_db;
```


```sql
USE anpr_db;
```


```sql
CREATE TABLE plate_reads (
    id INT AUTO_INCREMENT PRIMARY KEY,
    country VARCHAR(10) NOT NULL,
    reg_number VARCHAR(15) NOT NULL,
    confidence_level INT NOT NULL,
    camera_name VARCHAR(20) NOT NULL,
    date DATE NOT NULL,
    time CHAR(4) NOT NULL,  -- Stores time as HHmm
    image_filename VARCHAR(255) NOT NULL,
    UNIQUE (reg_number, date, time)  -- Ensures no duplicate entries for the same vehicle at the same time
);
```


## Database settings are configured in the db.js file using a connection pool to the MySQL database. Here is the configuration:

const pool = mysql.createPool({
  host: 'localhost',             // Database host, usually 'localhost'
  user: 'root',                  // Replace with your MySQL username
  password: '',                  // Replace with your MySQL password
  database: 'anpr_db',           // Replace with your database name
});

## Installation

1. Clone this repository.
2. Run `npm install` to install any required dependencies

## Usage

To run the application:

```bash
npm start
```

To test the application:

```bash
npm test
```








